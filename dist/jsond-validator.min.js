!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t["jsond-validator"]=r()}(this,function(){"use strict";function t(t){t.add("return E")}function r(t,r){if(Array.isArray(r)){var n=t.var("i");t.add("if(!Array.isArray(%s))"),t.error("ARRAY_REQUIRED"),t.add("else"),t.add("for(var %p=0;%p<%s.length;%p++){",n,n,n),r.length&&(t.stack(n,n),t.visit(r[0]),t.pop()),t.add("}")}}function n(t,r){r===O.boolean&&(t.add('if(typeof %s!=="boolean")'),t.error("BOOLEAN_REQUIRED"))}function e(t,r){t.add("if(%s!==%p)",JSON.stringify(r)),t.error("CONSTANT")}function i(t,r){r===O.integer&&(t.add('if(typeof %s!=="number"||%s<0||%s%1!==0)'),t.error("INTEGER_REQUIRED"))}function o(t,r){r===O.number&&(t.add('if(typeof %s!=="number")'),t.error("NUMBER_REQUIRED"))}function a(t,r){if("object"==typeof r){t.add('if(typeof %s!=="object")'),t.error("OBJECT_REQUIRED"),t.add("else {");for(var n={},e=Object.keys(r).map(function(t){var r=t.replace(O.optional,"");return n[r]=t===r,r}),i=0,o=e.length;i<o;i++){var a=e[i];n[a]&&(t.add('if(!%s.hasOwnProperty("%p"))',a),t.error("OBJECT_PROPERTY_REQUIRED",JSON.stringify(a)),t.add("else {"),t.stack(JSON.stringify(a),"'"+a+"'"),t.visit(r[a]),t.pop(),t.add("}"))}var s=t.var("k"),f=t.var("i"),c=e.map(function(t){return s+"["+f+']!=="'+t+'"'}),d=e.length?c.join("&&"):"true";t.add("var %p=Object.keys(%s)",s),t.add("for(var %p=0;%p<%p.length;%p++){",f,f,s,f),t.add("if(%p)",d),t.error("OBJECT_PROPERTIES_ADDITIONAL",void 0,s+"["+f+"]"),t.add("}"),t.add("}")}}function s(t,r,n){if("string"==typeof r){I(t,O.number);var e=n[2]&&n[2].length?Number(n[2]):null,i=n[3]&&n[3].length?Number(n[3]):null,o="["===n[1]?"<":"<=",a="]"===n[4]?">":">=";e&&(t.add("if(%s%p%p)",o,e),t.error("INTERVAL_START")),i&&(t.add("if(%s%p%p)",a,i),t.error("INTERVAL_END"))}}function f(t,r,n){if("string"==typeof r){I(t,O.number);var e=n[1].split(",").map(function(t){return parseFloat(t,10)});t.add("if(%p.indexOf(%s)===-1)",JSON.stringify(e)),t.error("NOT_IN_SET")}}function c(t,r){if("string"==typeof r){var n=r;"^"!==n[0]&&(n="^"+n),"$"!==n[n.length-1]&&(n+="$"),n=n.replace(/\//g,"\\/"),t.add("if(!/%p/.test(%s))",n),t.error("STRING_PATTERN")}}function d(t,r){if("string"==typeof r){var n,e=r.match(O.set);e?n=S:(e=r.match(O.interval),n=e?j:U),n(t,r,e)}}function p(t,r){r===O.string&&(t.add('if(typeof %s!=="string")'),t.error("STRING_REQUIRED"))}function u(t,r){var n;(n=Array.isArray(r)?b:"object"==typeof r?D:r===O.boolean?A:r===O.number?I:r===O.integer?T:r===O.string?B:"string"==typeof r?w:_)(t,r)}function h(t){t.add("var E=[]")}function l(t,r,n,e){var i="["+n.join(",")+"]"+(e?".concat(["+e+"])":"");t.add("E.push({code:%p,path:%p})",JSON.stringify(r),i)}function v(t){this.src=[],this.data=[],this.path=[],this.vars={},this.start(t)}function y(t,r){for(var n=t;"string"==typeof n&&r[n];)n=r[n];return n}function g(t,r){var n,e=y(t,r);return Array.isArray(e)?n=e.map(function(t){return g(t,r)}):E(e)?(n={},Object.keys(e).forEach(function(t){n[t]=g(e[t],r)})):n=e,n}function E(t){return null!=t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}function m(){this.schemas={},this.compiled={}}var R=t,b=r,N="\\-?(?:0|[1-9]\\d*)(?:\\.\\d+)?",O={boolean:"boolean",integer:"integer",interval:new RegExp("^(\\[|\\()("+N+")?,("+N+")?(\\]|\\))$"),number:"number",optional:/\?$/,set:new RegExp("^{("+N+"(,"+N+")*)}$"),string:"string"},A=n,_=e,T=i,I=o,D=a,j=s,S=f,U=c,w=d,B=p,J=u,k=h,G=l,Q="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};process.env.DEBUG&&(Q._DEBUG_=!0),void 0===Q._DEBUG_&&(Q._DEBUG_=!1),v.prototype={generate:function(){var t=this.src.join("\n");return new Function("data",t)},start:function(t){k(this),this.stack(JSON.stringify("$"),"data"),this.visit(t),R(this)},stack:function(t,r){this.path.push(t),this.data.push("data"===r?r:"["+r+"]")},visit:function(t){J(this,t)},error:function(t,r,n){var e=[].concat(this.path).concat(void 0===r?[]:[r]);G(this,t,e,n)},var:function(t){return this.vars[t]||(this.vars[t]=0),this.vars[t]++,t+this.vars[t]},pop:function(){this.data.pop(),this.path.pop()},add:function(t){var r=this.data.join(""),n=Array.prototype.slice.call(arguments,1);this.src.push(t.replace(/%s/g,r).replace(/%p/g,function(){return n.shift()}))}},v.compile=function(t){return new v(t).generate()};var P=v;return m.prototype={addSchema:function(t,r,n){var e=g(r,this.schemas);return this.schemas[t]=e,n||(this.compiled[t]=P.compile(e)),this},getDereferencedSchema:function(t){return g(this.schemas[t],this.schemas)},validate:function(t,r){!this.compiled[r]&&this.schemas[r]&&(this.compiled[r]=P.compile(this.schemas[r]));var n=this.compiled[r],e=n(t);return{valid:0===e.length,errors:e}}},m});
